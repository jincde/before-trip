{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'communities/css/style.css' %}">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
{% endblock css %}

{% block body %}
<div class="container">
    <div class="detail-section">
        <!-- 눈높이 맞추기용 div 나중에 수정할 것 -->
        <div class="eye" style="height: 200px;"></div>
        <div class="detail-title">
            {{ article.title }}
        </div>
        <div class="detail-meta-section">
            <div class="detail-user">
                <!-- 프로필사진이 있을 경우 나중에 수정할 것: accounts에서 프사 없으면 자동으로 설정되도록 해주기 = 프사없을 일 없음.-->
                <div class="detail-img-div">
                    {% if not article.user.profile_image %}
                    <img src="https://dummyimage.com/30x30/ededed/0011ff" alt="프사 없을 시 사진" class="profile-img">
                    {% else %}
                    <img src="{{ article.user.image.url }}" alt="" class="profile-img">
                    {% endif %}
                </div>
                <div class="detail-username">
                    {{ article.user.nick_name }}
                </div>
                <!-- 작성일 -->
                <div class="detail-created">
                    <!-- 작성일자 : ~시간 전 표시 -->
                    {% if article.created_string == False %}
                    <!-- 7일이 지나면 날짜로 출력 -->
                    {{ article.created_at | date:'m월 d일' }}
                    {% else %}
                    <!-- 7일이 지나기 전이라면 함수 대입한 결과 -->
                    {{ article.created_string }}
                    {% endif %}
                </div>
                <!-- 조회 수 -->
                <div>
                    조회 32
                </div>
            </div>
            <!-- 여행 기간 -->
            <div class="detail-date">
                <!-- 달력 아이콘 -->
                <span class="material-icons">
                    event_available
                </span>
                <span>{{ article.travel_start | date:"o. n. j" }}
                    ~</span><span>{{ article.travel_end | date:" o. n. j" }}</span>
            </div>
        </div>
        <hr>
        <!-- 리뷰 내용 -->
        <div class="detail-content">
            {{ article.content | safe }}
        </div>

        <div id="comment_footer" class="comment-ft">
            확인용
            <p>dasd</p>
            <p>dasd</p>
            <p>dasd</p>
            <p>dasd</p>
            <p>dasd</p>
            <p>dasd</p>
            <p>dasd</p>
        </div>
        <!-- 댓글 작성폼 -->
        <form id="article-{{ article.pk }}-comment-create-form" data-article-id="{{ article.pk }}"
            data-country-id="{{ country_code }}" onsubmit="submitComment(this.id)">
            {% csrf_token %}
            {% bootstrap_form comment_form %}
            <input type="submit" value="제출">
        </form>
        <!-- 댓글 영역 -->
        <a name="comment" class="comment-section">
            <span><span style="color: #428ce8;">{{ article.articlecomment_set.count }}</span>개의 댓글</span>
            <div id="comment-list-{{ article.pk }}" data-article-id="{{ article.pk }}">
                {% for comment in comments %}
                <div class="comment-row" id="comment-{{ comment.pk }}-row">
                    <div class="comment-wrapper">
                        <div class="comment-user">
                            <div class="comment-img-div">
                                {% if not comment.user.profile_image %}
                                <img src="https://dummyimage.com/48x48/ededed/0011ff" alt="프사 없을 시 사진"
                                    class="comment-profile-img">
                                {% else %}
                                <img src="{{ comment.user.profile_image.url }}" alt="" class="comment-profile-img">
                                {% endif %}
                            </div>
                        </div>
                        <div class="comment-main">
                            <div class="comment-user-date">
                                <p style="font-weight: 400;">{{ comment.user.nick_name }}</p>
                                <p class="comment-date">
                                    <!-- 작성일자 : ~시간 전 표시 -->
                                    {% if comment.created_string == False %}
                                    <!-- 7일이 지나면 날짜로 출력 -->
                                    {{ comment.created_at | date:'m월 d일' }}
                                    {% else %}
                                    <!-- 7일이 지나기 전이라면 함수 대입한 결과 -->
                                    {{ comment.created_string }}
                                    {% endif %}
                                </p>
                            </div>
                            <p id="comment-{{ comment.pk }}-update-hide">{{ comment.content }}</p>
                            <div id="comment-{{ comment.pk }}-update-form" class="update-form">
                                <textarea id="comment-{{ comment.pk }}-update-content"
                                    type="text">{{ comment.content }}</textarea>
                                <div class="buttons-update">
                                    <button id="comment-{{ comment.pk }}-update-cancel"
                                        data-comment-id="{{ comment.pk }}"
                                        onclick="updateCommentCancel(this.id)">취소</button>
                                    <button id="comment-{{ comment.pk }}-update-btn" class="update-comment"
                                        data-article-id="{{ article.pk }}" data-comment-id="{{ comment.pk }}"
                                        onclick="updateComment(this.id)">작성
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button id="subcomment-{{ comment.pk }}" class="subcomment-btn"
                            onclick="getCreateSubComment(this.id)">답글달기</button>
                        {% if user.pk == comment.user_id %}
                        <div id="comment-{{comment.pk}}-update-buttons" class="buttons">
                            <button id="comment-{{ comment.pk }}-update" data-article-id="{{ article.pk }}"
                                data-comment-id="{{ comment.pk }}" onclick="getUpdateComment(this.id)">수정
                            </button>
                            <button id="comment-{{ comment.pk }}-delete" data-article-id="{{ article.pk }}"
                                data-comment-id="{{ comment.pk }}" onclick="deleteComment(this.id)">삭제
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    <div id="subcomment-{{ comment.pk }}-commentlist" data-comment-id="{{ comment.pk }}"
                        class="sub-comment-list">

                        <!-- 이 댓글을 참조하고 있는 모든 대댓글을 순회 -->
                        {% for sub_comment in comment.articlecomment_set.all %}
                        <span>{{ sub_comment.pk }}</span>
                        <div class="comment-row" id="comment-{{ sub_comment.pk }}-row">
                            <div class="comment-wrapper">
                                <div class="comment-user">
                                    <div class="comment-img-div">
                                        {% if not comment.user.profile_image %}
                                        <img src="https://dummyimage.com/48x48/ededed/0011ff" alt="프사 없을 시 사진"
                                            class="comment-profile-img">
                                        {% else %}
                                        <img src="{{ sub_comment.user.profile_image.url }}" alt=""
                                            class="comment-profile-img">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="comment-main">
                                    <div class="comment-user-date">
                                        <p style="font-weight: 400;">{{ sub_comment.user.nick_name }}</p>
                                        <p class="comment-date">
                                            <!-- 작성일자 : ~시간 전 표시 -->
                                            {% if comment.created_string == False %}
                                            <!-- 7일이 지나면 날짜로 출력 -->
                                            {{ comment.created_at | date:'m월 d일' }}
                                            {% else %}
                                            <!-- 7일이 지나기 전이라면 함수 대입한 결과 -->
                                            {{ comment.created_string }}
                                            {% endif %}
                                        </p>
                                    </div>
                                    <p id="comment-{{ sub_comment.pk }}-update-hide">{{ sub_comment.content }}</p>
                                    <div id="comment-{{ sub_comment.pk }}-update-form" class="update-form">
                                        <textarea id="comment-{{ sub_comment.pk }}-update-content"
                                            type="text">{{ sub_comment.content }}</textarea>
                                        <div class="buttons-update">
                                            <button id="comment-{{ sub_comment.pk }}-update-cancel"
                                                data-comment-id="{{ sub_comment.pk }}"
                                                onclick="updateCommentCancel(this.id)">취소</button>
                                            <button id="comment-{{ sub_comment.pk }}-update-btn" class="update-comment"
                                                data-article-id="{{ article.pk }}"
                                                data-comment-id="{{ sub_comment.pk }}"
                                                onclick="updateComment(this.id)">작성
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button id="subcomment-{{ sub_comment.pk }}" class="subcomment-btn"
                                    onclick="getCreateSubComment(this.id)">답글달기</button>
                                {% if user.pk == sub_comment.user_id %}
                                <div id="comment-{{ sub_comment.pk}}-update-buttons" class="buttons">
                                    <button id="comment-{{ sub_comment.pk }}-update" data-article-id="{{ article.pk }}"
                                        data-comment-id="{{ sub_comment.pk }}" onclick="getUpdateComment(this.id)">수정
                                    </button>
                                    <button id="comment-{{ sub_comment.pk }}-delete" data-article-id="{{ article.pk }}"
                                        data-comment-id="{{ sub_comment.pk }}" onclick="deleteComment(this.id)">삭제
                                    </button>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% empty %}
                        {% endfor %}
                        <div id="comment-{{ comment.pk }}-create-sub-comment" class="sub-comment-create">
                            <form id="comment-{{ comment.pk }}-create-sub-comment-form"
                                data-article-id="{{ article.pk }}" data-parent-id="{{ comment.pk }}"
                                data-country-id="{{ country_code }}" onsubmit="submitSubComment(this.id)">
                                <input type="hidden" name="csrfmiddlewaretoken"
                                    value="UADJ0XlX9ehGoBzqzJvqbZdFXIbXvcW5dsG6C73APNDXwpn3x9oasIKKnyUBJGmn">
                                <div class="mb-3"><label class="form-label" for="id_content">Content</label><input
                                        type="text" name="content" maxlength="150" class="form-control"
                                        placeholder="Content" required="" id="id_content"></div>
                                <input type="submit" value="제출">
                            </form>
                        </div>
                    </div>
                </div>
                {% empty %}
                <span id="comment-none">작성된 댓글이 없습니다.</span>
                {% endfor %}
            </div>
        </a>
    </div>
    <!-- 사이드바 리모컨 -->
    <div class="side-bar">
        <div class="remote">
            {% if user == article.user %}
            <a href="{% url 'communities:review_update' country_code article.pk %}">
                <span class="material-icons">
                    edit
                </span>
            </a>
            <hr>
            <form action="{% url 'communities:delete' country_code article.pk %}" method="POST" id="delete_form">
                {% csrf_token %}
                <span id="review_delete" class="material-icons">
                    delete
                </span>
            </form>
            {% else %}
            <a href="#comment">
                <span class="material-icons md-18">
                    chat_bubble_outline
                </span>
            </a>
            <hr>
            <span class="material-icons md-18">
                thumb_up_alt
            </span>
            {% endif %}
            <hr>
            <a href="{% url 'communities:review' country_code %}">
                <span class="material-icons">
                    arrow_back
                </span>
            </a>
        </div>
    </div>
</div>



<nav id="test" class="test1"
    style="background-color: yellow; width: 100%; position: fixed ; height:65px; bottom:0; z-index: 1">
    <span><span style="color: #428ce8;">{{ article.articlecomment_set.count }}</span>개의 댓글</span>
</nav>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    let conPK = '{{ country_code }}';

    function displayedAt(createdAt) {
        let time = new Date(createdAt)
        const milliSeconds = new Date() - time
        const seconds = milliSeconds / 1000
        if (seconds < 60)
            return `방금 전`
        const minutes = seconds / 60
        if (minutes < 60)
            return `${Math.floor(minutes)}분 전`
        const hours = minutes / 60
        if (hours < 24)
            return `${Math.floor(hours)}시간 전`
        const days = hours / 24
        if (days < 7)
            return `${Math.floor(days)}일 전`
        const weeks = days / 7
        if (weeks < 5)
            return `${Math.floor(weeks)}주 전`
        const months = days / 30
        if (months < 12)
            return `${Math.floor(months)}개월 전`
        const years = days / 365
        return `${Math.floor(years)}년 전`
    }

    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    const getComment = function (e) {
        const comments = document.querySelector(`#${e}`);
        const commentsList = document.querySelector(`#${e}-list`);
        commentsList
            .classList
            .toggle('display-none');

        if (commentsList.classList.contains('display-none')) {
            comments.innerText = "댓글보기"
        } else {
            comments.innerText = "댓글닫기"
        }
    };
    // 여기도 안씀
    const getCreateComment = function (e) {
        const commentForm = document.querySelector(`#${e}-form`);
        commentForm.classList
            .toggle('display-none');
    }

    const submitComment = function (e) {

        event.preventDefault();
        const commentForm = document.querySelector(`#${e}`);

        const pk = event.target.dataset.articleId;
        const country = event.target.dataset.countryId;
        console.log("이벤트 발생")
        axios({
            method: 'post',
            url: `/communities/${conPK}/review/${pk}/review_detail/comment_create/`,
            headers: {
                'X-CSRFToken': csrftoken
            },
            data: new FormData(commentForm)
        }).then(response => {

            console.log(response)

            const commentList = document.querySelector(`#comment-list-${pk}`)

            commentList.textContent = "";
            console.log(commentList)

            for (let i = 0; i < response.data.comments_data.length; i++) {
                let date = displayedAt(response.data.comments_data[i].created_at)
                commentList.insertAdjacentHTML('beforeend',
                    `<div class="comment-row" id="comment-${response.data.comments_data[i].comment_pk}-row">
                                            <div class="comment-user">
                                                <div class="comment-img-div">
                                                    <img src="${response.data.comments_data[i].img_url}" alt="프사 없을 시 사진"
                                                        class="comment-profile-img">
                                                </div>
                                            </div>
                                            <div class="comment-main">
                                                <div class="comment-user-date">
                                                    <p style="font-weight: 400;">${response.data.comments_data[i].nick_name}</p>
                                                    <p class="comment-date">
                                                        ${date}
                                                    </p>
                                                </div>
                                                <p id="comment-${response.data.comments_data[i].comment_pk}-update-hide">${response.data.comments_data[i].content}</p>
                                                <div id="comment-${response.data.comments_data[i].comment_pk}-update-form" class="update-form">
                                                    <textarea id="comment-${response.data.comments_data[i].comment_pk}-update-content"
                                                        type="text">${response.data.comments_data[i].content}</textarea>
                                                    <div class="buttons-update">
                                                        <button id="comment-${response.data.comments_data[i].comment_pk}-update-cancel" data-comment-id="${response.data.comments_data[i].comment_pk}"
                                                            onclick="updateCommentCancel(this.id)">취소</button>
                                                        <button id="comment-${response.data.comments_data[i].comment_pk}-update-btn" class="update-comment"
                                                            data-article-id="${response.data.comments_data[i].article_id}" data-comment-id="${response.data.comments_data[i].comment_pk}"
                                                            onclick="updateComment(this.id)">작성
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>`)
                // 수정, 삭제 버튼 넣을 row
                if (response.data.comments_data[i].request_user_pk === response.data.comments_data[i].user_pk) {
                    const commentRow = document.querySelector(`#comment-${response.data.comments_data[i].comment_pk}-row`)
                    commentRow.insertAdjacentHTML('beforeend', `<div id="comment-${response.data.comments_data[i].comment_pk}-update-buttons" class="buttons">
                                            <button id="comment-${response.data.comments_data[i].comment_pk}-update" data-article-id="${response.data.comments_data[i].article_id}"
                                                data-comment-id="${response.data.comments_data[i].comment_pk}" onclick="getUpdateComment(this.id)">수정
                                            </button>
                                            <button id="comment-${response.data.comments_data[i].comment_pk}-delete" data-article-id="${response.data.comments_data[i].article_id}"
                                                data-comment-id="${response.data.comments_data[i].comment_pk}" onclick="deleteComment(this.id)">삭제
                                            </button>
                                        </div>`)
                }
                commentForm.reset();
            }

        })
    }

    const getUpdateComment = function (e) {
        console.log(e)
        const btNs = document.querySelector(`#${e}-buttons`)
        const updateCommentForm = document.querySelector(`#${e}-form`);
        const commentContent = document.querySelector(`#${e}-hide`);
        const commentBase = document.querySelector(`#${e}-hide`).innerText;

        btNs.style.display = "none";
        commentContent.style.display = "none";
        updateCommentForm.style.display = "block";
    }

    const test = function (e) {
        console.log("이벤트 발생")
    }


    const updateCommentCancel = function (e) {
        const comPk = event.target.dataset.commentId
        const btNs = document.querySelector(`#comment-${comPk}-update-buttons`)
        const updateCommentForm = document.querySelector(`#comment-${comPk}-update-form`);
        const commentContent = document.querySelector(`#comment-${comPk}-update-hide`)
        const commentBase = document.querySelector(`#comment-${comPk}-update-hide`).innerText
        const commentUpdateContent = document.querySelector(`#comment-${comPk}-update-content`)
        commentContent.style.display = "block";
        updateCommentForm.style.display = "none";
        btNs.style.display = "";
    }



    const updateComment = function (e) {
        const commentValue = document.querySelector(`#comment-${event.target.dataset.commentId}-update-content`).value;
        const pk = event.target.dataset.articleId;
        const coPk = event.target.dataset.commentId;
        const country = event.target.dataset.countryId;
        console.log(country)

        axios({
            method: 'post',
            url: `/communities/${conPK}/review/${pk}/review_detail/${coPk}/comment_update/`,
            headers: {
                'X-CSRFToken': csrftoken
            },
            data: {
                'content': commentValue
            }
        }).then(response => {

            console.log(response)
            console.log(pk, coPk, country, 1)
            const commentList = document.querySelector(`#comment-list-${pk}`)

            commentList.textContent = "";
            console.log(commentList)

            for (let i = 0; i < response.data.comments_data.length; i++) {
                let date = displayedAt(response.data.comments_data[i].created_at)
                commentList.insertAdjacentHTML('beforeend',
                    `<div class="comment-row" id="comment-${response.data.comments_data[i].comment_pk}-row">
                                            <div class="comment-user">
                                                <div class="comment-img-div">
                                                    <img src="${response.data.comments_data[i].img_url}" alt="프사 없을 시 사진"
                                                        class="comment-profile-img">
                                                </div>
                                            </div>
                                            <div class="comment-main">
                                                <div class="comment-user-date">
                                                    <p style="font-weight: 400;">${response.data.comments_data[i].nick_name}</p>
                                                    <p class="comment-date">
                                                        ${date}
                                                    </p>
                                                </div>
                                                <p id="comment-${response.data.comments_data[i].comment_pk}-update-hide">${response.data.comments_data[i].content}</p>
                                                <div id="comment-${response.data.comments_data[i].comment_pk}-update-form" class="update-form">
                                                    <textarea id="comment-${response.data.comments_data[i].comment_pk}-update-content"
                                                        type="text">${response.data.comments_data[i].content}</textarea>
                                                    <div class="buttons-update">
                                                        <button id="comment-${response.data.comments_data[i].comment_pk}-update-cancel" data-comment-id="${response.data.comments_data[i].comment_pk}"
                                                            onclick="updateCommentCancel(this.id)">취소</button>
                                                        <button id="comment-${response.data.comments_data[i].comment_pk}-update-btn" class="update-comment"
                                                            data-article-id="${response.data.comments_data[i].article_id}" data-comment-id="${response.data.comments_data[i].comment_pk}"
                                                            onclick="updateComment(this.id)">작성
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>`)
                // 수정, 삭제 버튼 넣을 row
                if (response.data.comments_data[i].request_user_pk === response.data.comments_data[i].user_pk) {
                    const commentRow = document.querySelector(`#comment-${response.data.comments_data[i].comment_pk}-row`)
                    commentRow.insertAdjacentHTML('beforeend', `<div id="comment-${response.data.comments_data[i].comment_pk}-update-buttons" class="buttons">
                                            <button id="comment-${response.data.comments_data[i].comment_pk}-update" data-article-id="${response.data.comments_data[i].article_id}"
                                                data-comment-id="${response.data.comments_data[i].comment_pk}" onclick="getUpdateComment(this.id)">수정
                                            </button>
                                            <button id="comment-${response.data.comments_data[i].comment_pk}-delete" data-article-id="${response.data.comments_data[i].article_id}"
                                                data-comment-id="${response.data.comments_data[i].comment_pk}" onclick="deleteComment(this.id)">삭제
                                            </button>
                                        </div>`)
                }
            }

        })
    }

    const testagain = function (e) {
        console.log("이벤트발생")
    }

    const deleteComment = function (e) {

        const pk = event.target.dataset.articleId;
        const coPk = event.target.dataset.commentId;
        const country = event.target.dataset.countryId;
        if (confirm("정말 삭제하시겠습니까?!") === true) {
            axios({
                method: 'post',
                url: `/communities/${conPK}/review/${pk}/review_detail/${coPk}/comment_delete/`,
                headers: {
                    'X-CSRFToken': csrftoken
                }
            }).then(response => {

                console.log(response)
                console.log(pk, coPk, country, 1)
                const commentList = document.querySelector(`#comment-list-${pk}`)

                commentList.textContent = "";
                console.log(commentList)

                for (let i = 0; i < response.data.comments_data.length; i++) {
                    let date = displayedAt(response.data.comments_data[i].created_at)
                    commentList.insertAdjacentHTML('beforeend',
                        `<div class="comment-row" id="comment-${response.data.comments_data[i].comment_pk}-row">
                            <div class="comment-user">
                                <div class="comment-img-div">
                                    <img src="${response.data.comments_data[i].img_url}" alt="프사 없을 시 사진"
                                        class="comment-profile-img">
                                </div>
                            </div>
                            <div class="comment-main">
                                <div class="comment-user-date">
                                    <p style="font-weight: 400;">${response.data.comments_data[i].nick_name}</p>
                                    <p class="comment-date">
                                        ${date}
                                    </p>
                                </div>
                                <p id="comment-${response.data.comments_data[i].comment_pk}-update-hide">${response.data.comments_data[i].content}</p>
                                <div id="comment-${response.data.comments_data[i].comment_pk}-update-form" class="update-form">
                                    <textarea id="comment-${response.data.comments_data[i].comment_pk}-update-content"
                                        type="text">${response.data.comments_data[i].content}</textarea>
                                    <div class="buttons-update">
                                        <button id="comment-${response.data.comments_data[i].comment_pk}-update-cancel" data-comment-id="${response.data.comments_data[i].comment_pk}"
                                            onclick="updateCommentCancel(this.id)">취소</button>
                                        <button id="comment-${response.data.comments_data[i].comment_pk}-update-btn" class="update-comment"
                                            data-article-id="${response.data.comments_data[i].article_id}" data-comment-id="${response.data.comments_data[i].comment_pk}"
                                            onclick="updateComment(this.id)">작성
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>`)
                    // 수정, 삭제 버튼 넣을 row
                    if (response.data.comments_data[i].request_user_pk === response.data.comments_data[i].user_pk) {
                        const commentRow = document.querySelector(`#comment-${response.data.comments_data[i].comment_pk}-row`)
                        commentRow.insertAdjacentHTML('beforeend', `<div id="comment-${response.data.comments_data[i].comment_pk}-update-buttons" class="buttons">
                            <button id="comment-${response.data.comments_data[i].comment_pk}-update" data-article-id="${response.data.comments_data[i].article_id}"
                            data-comment-id="${response.data.comments_data[i].comment_pk}" onclick="getUpdateComment(this.id)">수정
                        </button>
                            <button id="comment-${response.data.comments_data[i].comment_pk}-delete" data-article-id="${response.data.comments_data[i].article_id}"
                            data-comment-id="${response.data.comments_data[i].comment_pk}" onclick="deleteComment(this.id)">삭제
                            </button>
                        </div>`)
                    }
                }
            }
            )
        }
    }



    // 대댓글 생성 창 띄우기
    // 대댓글 생성 창 띄우기
    const getCreateSubComment = function (e) {
        const getSubBtn = document.querySelector(`#${e}`)
        const subCommentList = document.querySelector(`#${e}-commentlist`)
        // style = 엘리먼트 스타일로 들어감
        if (subCommentList.style.display === "block") {
            getSubBtn.innerText = "답글달기"
            subCommentList.style.display = "none"
        } else {
            getSubBtn.innerText = "숨기기"
            subCommentList.style.display = "block"
        }
    }


    // 대댓글 생성
    const submitSubComment = function (e) {
        event.preventDefault();
        const commentForm = document.querySelector(`#${e}`);
        const articlePk = event.target.dataset.articleId;
        const parentPk = event.target.dataset.parentId;
        axios({
            method: 'post',
            url: `/communities/${conPK}/review/${articlePk}/review_detail/${parentPk}/sub_comment_create/`,
            headers: {
                'X-CSRFToken': csrftoken
            },
            data: new FormData(commentForm)
        }).then(response => {
            console.log(response)

            const commentsList = document.querySelector(`#comment-list-${articlePk}`)

            commentsList.textContent = "";

            for (let i = 0; i < response.data.sub_comments_data.length; i++) {
                let date = displayedAt(response.data.sub_comments_data[i].created_at)
                if (response.data.sub_comments_data[i].request_user_pk === response.data.sub_comments_data[i].user_pk) {
                    commentsList.insertAdjacentHTML('beforeend', `<span>${response.data.sub_comments_data[i].nickname} | ${response.data.sub_comments_data[i].content} | ${response.data.sub_comments_data[i].created_at} </span>
              <button id="comment-${response.data.sub_comments_data[i].comment_pk}-update" data-review-id="${response.data.sub_comments_data[i].study_id}" data-comment-id="${response.data.sub_comments_data[i].comment_pk}" class="btn btn-outline-success" onclick="getUpdateComment(this.id)">수정</button>
              <button id="comment-${response.data.sub_comments_data[i].comment_pk}-delete" data-review-id="${response.data.sub_comments_data[i].study_id}" data-comment-id="${response.data.sub_comments_data[i].comment_pk}" class="btn btn-outline-danger" onclick="deleteComment(this.id)">삭제</button>
              <div id="comment-${response.data.sub_comments_data[i].comment_pk}-update-form" class="display-none">
              <input id="comment-${response.data.sub_comments_data[i].comment_pk}-update-content" type="text" value="${response.data.sub_comments_data[i].content}">
              <button id="comment-${response.data.sub_comments_data[i].comment_pk}-update-btn" class="btn btn-primary" data-review-id="${response.data.sub_comments_data[i].study_id}" data-comment-id="${response.data.sub_comments_data[i].comment_pk}" onclick="updateComment(this.id)">확인</button>
              </div><br>`);
                } else {
                    commentsList.insertAdjacentHTML('beforeend', `<span>${response.data.sub_comments_data[i].nickname} | ${response.data.sub_comments_data[i].content} | ${response.data.sub_comments_data[i].created_at} </span>`);
                }
            }
        })
    }
    /*
        window.onload = () => {
            const commentft = document.querySelector('.comment-ft');

                                        // 스크롤 이벤트를 감지하는 이벤트 리스너를 만들어줍니다.
                                        window.addEventListener('scroll', function () {
                                            console.log('스크롤 이벤트 감지!!');

                                        //뷰포트 총 길이 = 현재 보이는 화면의 바닥 좌표
                                        let viewheight = document.documentElement.clientHeight

                                        // 뷰포트 시작점과 푸터까지의 거리
                                        const distanceFromViewport = commentft
                                        .getBoundingClientRect()
                                        .top;
                if (distanceFromViewport > viewheight) {
                                            document
                                                .getElementById("test")
                                                .style
                                                .display = "block"
                                        } else {
                                            document
                                                .getElementById("test")
                                                .style
                                                .display = "none"
                                        } {
            # console.log('뷰포트 시작점과 푸터까지의 거리', distanceFromViewport);
                                        #
                } {
            ##
                } {
            # console.log('뷰포트의 총 높이', viewheight);
                                        #
                }
    
            });
        };
                                        */
</script>
<script>
    const reviewDelete = document.querySelector('#review_delete')
    reviewDelete.addEventListener('click', function (e) {
        if (confirm("정말로 삭제하시겠습니까?")) {
            const deleteForm = document.querySelector('#delete_form')
            deleteForm.submit();
        }
    })
</script>
{% endblock body %}